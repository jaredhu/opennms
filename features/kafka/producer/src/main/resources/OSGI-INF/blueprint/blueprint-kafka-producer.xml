<blueprint
	xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0"
	xsi:schemaLocation="
		http://www.osgi.org/xmlns/blueprint/v1.0.0
		http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
		
		http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0
		http://aries.apache.org/schemas/blueprint-cm/blueprint-cm-1.1.0.xsd
">

  <!-- Configuration properties -->
  <cm:property-placeholder id="kafkaProducerProperties" persistent-id="org.opennms.features.kafka.producer" update-strategy="reload">
    <cm:default-properties>
      <cm:property name="eventTopic" value="events"/>
      <cm:property name="alarmTopic" value="alarms"/>
      <cm:property name="nodeTopic" value="nodes"/>
    </cm:default-properties>
  </cm:property-placeholder>

  <reference id="configAdmin" interface="org.osgi.service.cm.ConfigurationAdmin" />
  <reference id="eventConfDao" interface="org.opennms.netmgt.config.api.EventConfDao" />
  <reference id="eventSubscriptionService" interface="org.opennms.netmgt.events.api.EventSubscriptionService" />
  <reference id="alarmLifecycleSubscriptionService" interface="org.opennms.netmgt.alarmd.api.AlarmLifecycleSubscriptionService" />

  <bean id="protobufMapper" class="org.opennms.features.kafka.producer.ProtobufMapper">
    <argument ref="eventConfDao"/>
  </bean>

  <bean id="nodeCache" class="org.opennms.features.kafka.producer.NodeCache"/>

  <bean id="kafkaProducer" class="org.opennms.features.kafka.producer.OpennmsKafkaProducer"
          init-method="init" destroy-method="destroy">
    <argument value="${eventTopic}"/>
    <argument value="${alarmTopic}"/>
    <argument value="${nodeTopic}"/>
    <argument ref="protobufMapper"/>
    <argument ref="nodeCache"/>
    <argument ref="configAdmin"/>
    <argument ref="eventSubscriptionService"/>
    <argument ref="alarmLifecycleSubscriptionService"/>
  </bean>

</blueprint>
